# xStorage p2p & blockChain Key Tech

**<p align="right">Paul 2018-4-18</p>**

***
## 目录
[toc]
***

## Chapter 1、p2p Key Tech

### Kademlia DHT

Kademlia是一种通过分散式杂凑表实现的协议算法，它是由Petar和David为非集中式P2P计算机网络而设计的。Kademlia规定了网络的结构，也规定了通过节点查询进行信息交换的方式。Kademlia网络节点之间使用UDP进行通讯。参与通讯的所有节点形成一张虚拟网（或者叫做覆盖网）。这些节点通过一组数字（或称为节点ID）来进行身份标识。节点ID不仅可以用来做身份标识，还可以用来进行值定位（值通常是文件的散列或者关键词）。其实，节点ID与文件散列直接对应，它所表示的那个节点存储着哪儿能够获取文件和资源的相关信息。当我们在网络中搜索某些值（即通常搜索存储文件散列或关键词的节点）的时候，Kademlia算法需要知道与这些值相关的键，然后分步在网络中开始搜索。每一步都会找到一些节点，这些节点的ID与键更为接近，如果有节点直接返回搜索的值或者再也无法找到与键更为接近的节点ID的时候搜索便会停止。

### S Kademlia DHT

 S/Kademlia DHT. S/Kademlia DHT同样是继承了Kademlia，并且做了一些改进，系统可以防止恶意攻击，例如女巫攻击。

### Merkle Tree (Hash Tree)

密码学及计算机科学中，哈希树（Hash Tree）是一种树形结构，每个叶节点均已数据块的hash作为标签，而非叶节点则以其子节点标签的加密哈希作为标签。hash树能够高效、安全的验证大型数据结构内容，是哈希链的推广形式。

哈希树的概念由瑞夫·墨克于 1979 年申请专利，故亦称墨克树（Merkle tree）。

在点对点网络中作数据传输的时候，会同时从多个机器上下载数据，而且很多机器可以认为是不稳定或者不可信的。为了校验数据的完整性，更好的办法是把大的文件分割成小的数据块（例如，把分割成2K为单位的数据块）。这样的好处是，如果小块数据在传输过程中损坏了，那么只要重新下载这一快数据就行了，不用重新下载整个文件。

怎么确定小的数据块没有损坏哪？只需要为每个数据块做Hash。BT下载的时候，在下载到真正数据之前，我们会先下载一个Hash列表。那么问题又来了，怎么确定这个Hash列表本事是正确的哪？答案是把每个小块数据的Hash值拼到一起，然后对这个长字符串在作一次Hash运算，这样就得到Hash列表的根Hash(Top Hash or Root Hash)。下载数据的时候，首先从可信的数据源得到正确的根Hash，就可以用它来校验Hash列表了，然后通过校验后的Hash列表校验数据块。

### Merkle Directed Acyclic Graph (Merkle DAG)

Merkle Directed Acyclic Graph 是建立在 Merkle Tree上的有向无环图，但不完全一样，比如Merkle DAG不需要进行树的平衡操作，非叶子节点允许包含数据等。

Merkle DAG拥有如下功能：

- 内容寻址：使用多重哈希来唯一识别一个数据块的内容
- 防篡改：可以方便的检查哈希值来确认数据是否被篡改
- 去重：由于内容相同的数据块哈希是相同的，可以很容去掉重复的数据，节省存储空间





## Chapter 2、blockChain Key Tech

区块链是一种去中心化的分布式账本系统，它可以用于登记和发行数字化资产、产权凭证、积分等，并以点对点的方式进行转账、支付和交易。区块链系统与传统的中心化账本系统相比，具有完全公开、不可篡改、防止多重支付等优点，并且不依赖于任何的可信第三方。

由于点对点网络下存在较高的网络延迟，各个节点所观察到的事务先后顺序不可能完全一致。因此区块链系统需要设计一种机制对在差不多时间内发生的事务的先后顺序进行共识。这种对一个时间窗口内的事务的先后顺序达成共识的算法被称为“共识机制”。

### POW (Prof of Work)

PoW采用简单粗暴但极为有效的方式，通过节点首先自证其资质后才进行广播的方式，大幅度减少了网络间的通讯压力，但与之带来的问题则在于自证资质的计算资源消耗极大。


### POS (Prof of State)

PoS采用与传统分布式一致性验证类似的机制，通过代币数量（或存储容量等指标）作为权重依据，使用某种分布式算法选举出每次的检查点节点。这种机制的好处在于没有消耗计算资源的自证资质过程，但是带来的问题在于每次选举时在大量节点的网络中对网络压力极大。

### DPOS (Delegated Prof of Stake)

委任权益证明Delegated Proof of Stake（简称DPoS）是比特股BitShares采用的区块链公识算法。在加密货币技术中，使用共识算法来保证整个区块链网络的安全可靠，著名的共识算法包括比特币网络使用的工作量证明PoW，以及Peercoin和NXT使用的权益证明PoS。但是，这些共识算法都不能解决交易性能问题，尤其是PoW算法大量消耗计算所需的电力。而委任权益证明DPoS很好地解决了性能和能耗的问题。

DPoS作为PoS的变形，通过缩小选举节点的数量以减少网络压力，是一种典型的分治策略：将所有节点分为领导者与跟随者，只有领导者之间达成共识后才会通知跟随者。该机制能够在不增加计算资源的前提下有效减少网络压力.

### PBFT (Pratical Byzantine Fault Tolerance)

PBFT是Practical Byzantine Fault Tolerance的缩写，意为实用拜占庭容错算法。该算法是Miguel Castro (卡斯特罗)和Barbara Liskov（利斯科夫）在1999年提出来的，解决了原始拜占庭容错算法效率不高的问题，将算法复杂度由指数级降低到多项式级，使得拜占庭容错算法在实际系统应用中变得可行。

### PAXOS

Paxos 问题是指分布式的系统中存在故障（fault），但不存在恶意（corrupt）节点场景（即可能消息丢失或重复，但无错误消息）下的共识达成（Consensus）问题

PAXOS是一种基于消息传递且具有高度容错特性的一致性算法。

### RAFT

Raft 算法是Paxos 算法的一种简化实现。
